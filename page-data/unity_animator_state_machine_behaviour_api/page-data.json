{"componentChunkName":"component---src-templates-blog-post-js","path":"/unity_animator_state_machine_behaviour_api/","result":{"data":{"markdownRemark":{"html":"<h2>문제 제기</h2>\n<p>나는 이번 스프린트에 \"유니티 애니메이터(Animator)를 통해 재생되는 애니메이션 클립(<a href=\"https://docs.unity3d.com/ScriptReference/AnimationClip.html\">AnimationClip</a>)의 특정 시점에 커스터마이징 가능한 동작을 추가해야 하는 업무\"가 주어졌다. 이에 나는 며칠 간의 리서치 일정을 거쳐 삽질 끝에 <strong>StateMachineBehaviour</strong>를 활용해 해당 기능을 구현하였다. 리서치 기간 동안에는 따로 계획을 하기보다는 정보 수집을 병행해 핵심 기능을 먼저 구현하는 식으로 접근하였다.</p>\n<p>특히, 이번 업무는 커스텀 에디터(<a href=\"https://docs.unity3d.com/Manual/editor-CustomEditors.html\">Custom Editors</a>)를 통해 해당 동작을 구현해야 했으므로 이러한 특수한 구현이 필요했다. 문제를 해결하는 과정에서 나는 해당 요구사항을 <a href=\"https://docs.unity3d.com/ScriptReference/AnimationClip.AddEvent.html\">AnimationClip.AddEvent</a> 메서드를 통해 구현했으므로 관심있는 분들은 다음 <a href=\"https://sungkukpark.github.io/unity_how_to_add_animation_events_dynamically/\">[Unity] 애니메이션 이벤트(AnimationEvent) 동적으로 추가하기</a> 포스팅을 참고하기 바란다.</p>\n<h2>3줄 요약</h2>\n<ol>\n<li>애니메이터의 특정 상태의 조건에 따라 원하는 동작을 수행하고 싶다면?</li>\n<li>StateMachineBehaviour를 활용해 해당 동작을 구현한다.</li>\n<li>예컨대, 이는 특정 캐릭터의 공격 시점에 특정 이펙트를 생성하거나 등의 용도로 활용할 수 있다.</li>\n</ol>\n<h2>StateMachineBehaviour란?</h2>\n<p><strong>StateMachineBehaviour</strong>는 애니메이터(Animator)의 스테이트 머신 상태에 추가할 수 있는 컴포넌트(Component)다. StateMachineBehaviour는 상태에 추가되는 모든 스크립트가 상속받는 기반 클래스(base class)다. 즉, 씬(Scene)에 MonoBehaviour가 있다면, 애니메이터에는 StateMachineBehaviour가 있다.</p>\n<p>애니메이터는 디폴트 동작으로 애니메이션 컨트롤러에 정의된 모든 StateMachineBehaviour의 인스턴스를 생성한다. 그러나 <a href=\"https://docs.unity3d.com/ScriptReference/SharedBetweenAnimatorsAttribute.html\">SharedBetweenAnimatorsAttribute</a> 어트리뷰트를 사용하면 해당 인스턴스가 어떻게 생성될 것인지 통제할 수 있다.</p>\n<p>StateMachineBehaviour는 다음과 같은 미리 지정된 메시지들을 갖는다:</p>\n<ul>\n<li>OnStateEnter</li>\n<li>OnStateExit</li>\n<li>OnStateIK</li>\n<li>OnStateMove</li>\n<li>OnStateUpdate.</li>\n</ul>\n<h2>StateMachineBehaviour 구현을 애니메이터에 추가하는 법</h2>\n<ol>\n<li>\n<p>하단의 샘플 코드를 참고해 StateMachineBehaviour를 상속받은 스크립트 파일을 생성한다.</p>\n</li>\n<li>\n<p>애니메이터 창에서 상태(State) 하나를 선택한 뒤 인스펙터 창에서 \"Add Behaviour\" 버튼을 클릭한다.</p>\n</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1324bbe9be0691bc7b8335ef7866a680/14747/before_add_attack_behaviour.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACEklEQVQ4y32TW5OaQBCF/SVr1OHSgKBcZRhuogi7uVbykMo+pPKQpPY1/7/qpHqilsaYh8MwQ/Fx+nQzaZoG+/0eSinEcYwgCOD7/pWWyyWSJEFRFNgfDhjGEWEYwnEcuK6r19Vqhc1mg8lut0Nd1+CVD23bBhHdiF/iZ2mWYdt1GhgniTbAUNZ6vcaEqXmeI01TfXgJ5PvLvWVZGtS2LaSUiKJIm2Cxe2ZM+MLQLMtugH+LgVx63/cayBGxGDwMA8qyxIRBd4HOLZAB4zieM2fxR3jPld4FWoYJUwhYhgE6nvEzzombWFUVTnGx2N1/Ha7yDHFdIlQSjuedgZwXl8s5MpjL77pON5YZd4Fx3yF//4TwsIVJNkxDnIG5lFB1i6br0fWPUE0HVVZI0+Qa6PFMkQ3XIVhigSjeoO1G7A6vUe9GeJ6PwPchiwrDp+/oP/6AevqK4vEb5PYt0iS6BpLjYSocvDIID4KQlR22hydkzQ5R2cJ0PT13nFldVyiVQlFIKFXoGPTYnIBxmkGGhJd+jp+DjV9vCIN0sVgYyAwBZZrILQvr4x/BgKJQurusG2CSZkgDwud8iudyhmc5hQwEHJvwYT7HFyHwbjZDxMA814OstMPi30BdsuvhYeVBpC6m4RIGOSCyIYiwIII4NeUCeNeh7rLnYl47MMYA886F7RHIJjj0R3QEnuaPIZcrA38D5RvCKnRlqZIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"unity_animator_state_machine_behaviour_api\"\n        title=\"unity_animator_state_machine_behaviour_api\"\n        src=\"/static/1324bbe9be0691bc7b8335ef7866a680/5a190/before_add_attack_behaviour.png\"\n        srcset=\"/static/1324bbe9be0691bc7b8335ef7866a680/772e8/before_add_attack_behaviour.png 200w,\n/static/1324bbe9be0691bc7b8335ef7866a680/e17e5/before_add_attack_behaviour.png 400w,\n/static/1324bbe9be0691bc7b8335ef7866a680/5a190/before_add_attack_behaviour.png 800w,\n/static/1324bbe9be0691bc7b8335ef7866a680/c1b63/before_add_attack_behaviour.png 1200w,\n/static/1324bbe9be0691bc7b8335ef7866a680/29007/before_add_attack_behaviour.png 1600w,\n/static/1324bbe9be0691bc7b8335ef7866a680/14747/before_add_attack_behaviour.png 1914w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol start=\"3\">\n<li>추가된 StateMachineBehaviour 구현에 필요한 <code class=\"language-text\">public</code> 데이터 필드를 모두 채워넣는다.</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/72c0e94ede19384da6f21b23ff30795b/6fa81/after_add_attack_behaviour.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACC0lEQVQ4y5WTy47TQBBF8yFIJMHd7rbjV/xsP2IntvMYaTIjIUYIsWDDggU/gMS3X1SVDJokjMQsrhzbt07XrZQnVd1gGLdo2xZZliGKIvi+f6OiKFBXFfZ3BwzDwD6tNRzHYXmeB2MMJpvNBl3Xou975HkOKSUbX0opBe04sG0bVV2j7Tosl0vESYwgCOC6LosOmWR5DmNKptNLLr4CPouAlII6JH+apQyhOrqnhiZpmvIPivQ/QPJRGgIkSYI4jvm63Z7GxkAyvQVIxdfAqqpQluXrQLoq2z7p/IyA5D/sD2iahmsIQqpptq92qBQc18Ui8OGFAdzF4u8h5KfIXddh3XUMom5XqxVrQkO+AGoFJSSitkb79QnNl4/w6gLWbAYhBBf3Q88R+3FkCMUOw/D0p1wDuTtHQysbrrtAkpUw9QqmbuGHSwbSDMm/TBJeF+qcDqMUN8C5UJhLjekHCR0kODx+xv7xCdvjJ+T1hteEZrXb7TCOI2u9XnN06vQG2KcSB+PgrnRw30bwFi6EZXEH0pa80OSlyBSXZrlqGr6n5xfAMPDxc3iHX8cpfj9M8aN/D6E1einxXQh8syyswxAZLXGW8ZI/i+b3zxnOLA0hFXczFxpKa7i2jUBK+EIgjiIUxqA4fwwvdQk0BQIvgCgd2A8R5DGELFxoqaAcDUXfstYc2ZyLr4EU+Q9SosEs/hxmHgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"unity_animator_state_machine_behaviour_api\"\n        title=\"unity_animator_state_machine_behaviour_api\"\n        src=\"/static/72c0e94ede19384da6f21b23ff30795b/5a190/after_add_attack_behaviour.png\"\n        srcset=\"/static/72c0e94ede19384da6f21b23ff30795b/772e8/after_add_attack_behaviour.png 200w,\n/static/72c0e94ede19384da6f21b23ff30795b/e17e5/after_add_attack_behaviour.png 400w,\n/static/72c0e94ede19384da6f21b23ff30795b/5a190/after_add_attack_behaviour.png 800w,\n/static/72c0e94ede19384da6f21b23ff30795b/c1b63/after_add_attack_behaviour.png 1200w,\n/static/72c0e94ede19384da6f21b23ff30795b/29007/after_add_attack_behaviour.png 1600w,\n/static/72c0e94ede19384da6f21b23ff30795b/6fa81/after_add_attack_behaviour.png 1856w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2><a href=\"https://gist.github.com/sungkukpark/cc4c344a7900bd7519cebaf2bb7a3e6d\">샘플 코드</a></h2>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AttackBehaviour</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">StateMachineBehaviour</span></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">GameObject</span> particle<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> radius<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> power<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\"><span class=\"token keyword\">float</span></span> upwardsModifier <span class=\"token operator\">=</span> <span class=\"token number\">3.0f</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">GameObject</span> _clone<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">// OnStateEnter is called when a transition starts and the state machine starts to evaluate this state.</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">OnStateEnter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Animator</span> animator<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AnimatorStateInfo</span> stateInfo<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> layerIndex<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        _clone <span class=\"token operator\">=</span> <span class=\"token function\">Instantiate</span><span class=\"token punctuation\">(</span>particle<span class=\"token punctuation\">,</span> animator<span class=\"token punctuation\">.</span>rootPosition<span class=\"token punctuation\">,</span> Quaternion<span class=\"token punctuation\">.</span>identity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> rb <span class=\"token operator\">=</span> _clone<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">GetComponent</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>Rigidbody<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        rb<span class=\"token punctuation\">.</span><span class=\"token function\">AddExplosionForce</span><span class=\"token punctuation\">(</span>power<span class=\"token punctuation\">,</span> animator<span class=\"token punctuation\">.</span>rootPosition<span class=\"token punctuation\">,</span> radius<span class=\"token punctuation\">,</span> upwardsModifier<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token comment\">// OnStateUpdate is called on each Update frame between OnStateEnter and OnStateExit callbacks.</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">OnStateUpdate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Animator</span> animator<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AnimatorStateInfo</span> stateInfo<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> layerIndex<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"On Attack Update.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// OnStateExit is called when a transition ends and the state machine finishes evaluating this state.</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">OnStateExit</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Animator</span> animator<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AnimatorStateInfo</span> stateInfo<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> layerIndex<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">Destroy</span><span class=\"token punctuation\">(</span>_clone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token comment\">// OnStateMove is called right after Animator.OnAnimatorMove(). Code that processes and affects root motion should be implemented here.</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">OnStateMove</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Animator</span> animator<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AnimatorStateInfo</span> stateInfo<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> layerIndex<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"On Attack Move.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// OnStateIK is called right after Animator.OnAnimatorIK(). Code that sets up animation IK (inverse kinematics) should be implemented here.</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">OnStateIK</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Animator</span> animator<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AnimatorStateInfo</span> stateInfo<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> layerIndex<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        Debug<span class=\"token punctuation\">.</span><span class=\"token function\">Log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"On Attack IK.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>참고 자료</h2>\n<ul>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/StateMachineBehaviour.html\">Unity - Scripting API: StateMachineBehaviour</a></li>\n<li><a href=\"https://github.com/tsubaki/Unity-AssetRequest/blob/master/Assets/Sample/Script/DestroyBehaviour.cs\">Unity-AssetRequest/DestroyBehaviour.cs at master · tsubaki/Unity-AssetRequest</a></li>\n</ul>","frontmatter":{"title":"[유니티] StateMachineBehaviour 소개 및 구현 방법"},"excerpt":"문제 제기 나는 이번 스프린트에 \"유니티 애니메이터(Animator)를 통해 재생되는 애니메이션 클립(AnimationClip…"}},"pageContext":{"slug":"/unity_animator_state_machine_behaviour_api/"}},"staticQueryHashes":["3159585216","63159454"]}